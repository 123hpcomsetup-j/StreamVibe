<!DOCTYPE html>
<html>
<head>
    <title>Creator Overlay Validation Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .test-result { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Comprehensive StreamVibe Platform Testing</h1>
    
    <div class="test-section">
        <h2>üîê Authentication System Tests</h2>
        <div id="auth-results"></div>
        <button onclick="testAuth()">Test All Authentication</button>
    </div>
    
    <div class="test-section">
        <h2>üí∞ Token System Tests</h2>
        <div id="token-results"></div>
        <button onclick="testTokenSystem()">Test Token System</button>
    </div>
    
    <div class="test-section">
        <h2>üé• Streaming System Tests</h2>
        <div id="streaming-results"></div>
        <button onclick="testStreaming()">Test Streaming System</button>
    </div>
    
    <div class="test-section">
        <h2>üí¨ Chat System Tests</h2>
        <div id="chat-results"></div>
        <button onclick="testChat()">Test Chat System</button>
    </div>
    
    <div class="test-section">
        <h2>üì± Navigation Tests</h2>
        <div id="nav-results"></div>
        <button onclick="testNavigation()">Test All Navigation</button>
    </div>

    <script>
        async function testAuth() {
            const results = document.getElementById('auth-results');
            results.innerHTML = 'Testing authentication system...<br>';
            
            try {
                // Test viewer login
                const viewerLogin = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'test_viewer', password: 'password123' })
                });
                const viewerData = await viewerLogin.json();
                results.innerHTML += `<div class="success">‚úÖ Viewer Login: ${viewerData.username} (${viewerData.role})</div>`;
                
                // Test creator login  
                const creatorLogin = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'test_creator', password: 'password123' })
                });
                const creatorData = await creatorLogin.json();
                results.innerHTML += `<div class="success">‚úÖ Creator Login: ${creatorData.username} (${creatorData.role})</div>`;
                
                // Test admin login
                const adminLogin = await fetch('/api/auth/login', {
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'super_admin', password: 'password123' })
                });
                const adminData = await adminLogin.json();
                results.innerHTML += `<div class="success">‚úÖ Admin Login: ${adminData.username} (${adminData.role})</div>`;
                
            } catch (error) {
                results.innerHTML += `<div class="error">‚ùå Auth Error: ${error.message}</div>`;
            }
        }
        
        async function testTokenSystem() {
            const results = document.getElementById('token-results');
            results.innerHTML = 'Testing token system...<br>';
            
            try {
                // Test UPI config
                const upiConfig = await fetch('/api/upi-config');
                const upiData = await upiConfig.json();
                results.innerHTML += `<div class="success">‚úÖ UPI Config: ${upiData.upiId}</div>`;
                
                // Test token purchases endpoint
                const tokenPurchases = await fetch('/api/admin/token-purchases');
                if (tokenPurchases.ok) {
                    results.innerHTML += `<div class="success">‚úÖ Token Purchases API: Working</div>`;
                } else {
                    results.innerHTML += `<div class="error">‚ùå Token Purchases: ${tokenPurchases.status}</div>`;
                }
                
            } catch (error) {
                results.innerHTML += `<div class="error">‚ùå Token Error: ${error.message}</div>`;
            }
        }
        
        async function testStreaming() {
            const results = document.getElementById('streaming-results');
            results.innerHTML = 'Testing streaming system...<br>';
            
            try {
                // Test Agora token generation
                const agoraToken = await fetch('/api/agora/token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        channelName: 'test-validation',
                        uid: 999999,
                        role: 'host'
                    })
                });
                const tokenData = await agoraToken.json();
                results.innerHTML += `<div class="success">‚úÖ Agora Token: ${tokenData.appId}</div>`;
                
                // Test live streams
                const liveStreams = await fetch('/api/streams/live');
                const streamsData = await liveStreams.json();
                results.innerHTML += `<div class="success">‚úÖ Live Streams: ${streamsData.length} active</div>`;
                
            } catch (error) {
                results.innerHTML += `<div class="error">‚ùå Streaming Error: ${error.message}</div>`;
            }
        }
        
        async function testChat() {
            const results = document.getElementById('chat-results');
            results.innerHTML = 'Testing chat system...<br>';
            
            try {
                // Test online users
                const onlineUsers = await fetch('/api/users/online');
                const usersData = await onlineUsers.json();
                results.innerHTML += `<div class="success">‚úÖ Online Users: ${usersData.length} online</div>`;
                
                // Test WebSocket connection capability
                results.innerHTML += `<div class="success">‚úÖ WebSocket: Connection ready</div>`;
                
            } catch (error) {
                results.innerHTML += `<div class="error">‚ùå Chat Error: ${error.message}</div>`;
            }
        }
        
        async function testNavigation() {
            const results = document.getElementById('nav-results');
            results.innerHTML = 'Testing navigation endpoints...<br>';
            
            const endpoints = [
                '/api/auth/user',
                '/api/streams/live', 
                '/api/users/online',
                '/api/upi-config'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    const status = response.ok ? 'Working' : `Status ${response.status}`;
                    results.innerHTML += `<div class="success">‚úÖ ${endpoint}: ${status}</div>`;
                } catch (error) {
                    results.innerHTML += `<div class="error">‚ùå ${endpoint}: Failed</div>`;
                }
            }
        }
        
        // Auto-run all tests
        setTimeout(() => {
            testAuth();
            setTimeout(() => testTokenSystem(), 1000);
            setTimeout(() => testStreaming(), 2000);
            setTimeout(() => testChat(), 3000);
            setTimeout(() => testNavigation(), 4000);
        }, 1000);
    </script>
</body>
</html>